---
layout: single
title:  "[CHAP3] 컴퓨팅 서비스 - 6"
categories: AWS
---

# 06. 서버리스 활용법 이해

## * AWS Lambda는 다른 서비스와 연계해 사용

Lambda 함수는 입력받은 데이터를 처리하기도 하지만, **다른 AWS 서비스와 연계**해 사용자 접속이나 데이터 연동과 같은 처리를 자동으로 수행할 수도 있음  

예시

1. 사용자 요청에 따라 Lambda 함수 실행
  - **Amazon API Gateway(API Gateway)** 서비스와 Lambda를 결합해 사용자의 HTTP 요청을 Lambda 함수로 처리할 수 있음, 이를 통해 간단한 웹 응용 프로그램도 만들 수 있음  
  - API Gateway는 사용자로부터 HTTP 요청을 받으면 GET과 같은 HTTP 메서드나 /api 등의 요청 경로에 대한 정보가 포함된 JSON 데이터를 Lambda 함수에 전달함  
  - Lambda 함수에서 응답 내용을 반환하도록 코드를 작성하면 API Gateway를 통해 응답을 반환 함  
  - 웹 브라우저라면 웹 브라우저 화면에 응답 데이터가 표시됨
  - API Gateway도 서버리스 서비스이므로 사용자는 서버를 구축하지 않고도 웹 응용 프로그램을 만들 수 있음


2. S3에 데이터를 저장할 때 자동 처리
  - **Amazon S3 버킷**에 데이터가 저장되면 저장된 데이터를 Lambda로 자동 처리할 수 있음, 예를 들어 데이터에 포함된 정보를 가공해 다른 S3 버킷에 저장하는 등 처리가 가능함
  - 이 경우에도 S3 버킷이나 데이터 정보가 **JSON 형식**으로 Lambda 함수에 전달되므로 Lambda 함수에서는 이 데이터를 처리하도록 구현하면 됨  


3. 주기적으로 Lambda 함수 실행
  - 매일 12:00 등 주기적으로 정해진 시간에 어떤 처리를 하고 싶다면 **Amazon EventBridge**라는 서비스와 Lambda를 연계해 구현할 수 있음
  - EventBridge에 규칙이라는 형태로 매일 실행할 내용을 정의해두고 실행 대상에 Lambda 함수를 지정하면 주기적인 실행이 가능함 (매일 정해진 시간에 EC2를 중지하거나 시작하는 작업도 가능)


## * AWS Lambda 추가 설정 및 모니터링

Lambda의 실행 환경은 일반적으로 AWS 측에서 관리하므로 사용자는 특별히 서버 설정에 관여하지 않아도 됨

* 사용자가 변경할 수 있는 설정 3가지

1. **메모리 용량** : 함수 실행 시 사용할 수 있는 메모리 용량을 지정, 128MB에서 10,240MB까지 지정 가능, CPU값은 지정X, 지정된 메모리 용량에 비례해 설정됨
2. **타임아웃 시간** : 함수가 실행되는 최대 시간, 이 시간이 지나도 실행되고 있는 경우 정지됨, 기본값은 3초, 1 ~ 900초 사이로 지정 가능
3. **환경 변수** : 함수에 사용하는 외부 변수와 같은 개념, 개발 환경과 서비스 환경이 서로 다른 데이터베이스를 사용해야 하는 경우, 환경 변수에
데이터베이스 접속 정보를 저장해두면 동일한 코드를 사용해도 서로 다른 데이터베이스를 이용할 수 있음, 환경마다 서로 다른 소스 코드를 만들지 않아도 됨

Lambda는 S3에 데이터를 저장하거나 EC2를 시작/중지 하는 등 다른 AWS 자원을 조작하기 위한 목적으로 사용되는 경우가 많지만, 처음 Lambda 함수를 만들면 다른 서비스에 대한 **조작 권한**을 따로 부여해야 함  
Lambda 함수에 **IAM(Identity and Access Management)** 역할형식으로 권한을 부여해야 함, 이 IAM 역할은 사용자가 권한을 설정해 생성함  
IAM 역할을 지정하지 않으면 Lambda 기본 IAM 역할이 자동으로 만들어지고 설정됨  
자동으로 생성된 IAM 역할에는 **Amazon CloudWatch** 라는 감시 서비스로 로그를 보낼 수 있는 권한만 부여 됨  
Lambda에 권한을 설정할 때는 **처리 내용에 필요한 최소한의 권한**을 설정하는 것이 중요  


## * Lambda 함수 실행 상태 모니터링

Lambda 함수를 만들어 배포하면 AWS 모니터링 서비스인 **CloudWatch**에 다음과 같은 정보가 자동으로 전송되므로 사용자는 Lambda 실행 상황을 확인할 수 있음  
(실행 횟수, 실행 시간(최소/최대/평균), 오류 수와 실행 성공률)  
실행 횟수와 같은 숫자 정보(Metric) 뿐만 아니라 함수가 출력하는 로그도 CloudWatch로그로 자동 전송 됨, 사용자는 여기서 자세한 함수 실행 내용을 확인할 수 있음  
CloudWatch를 사용하면 별도의 설정 없이 이러한 모니터링이 가능하지만, AWS의 다른 서비스나 외부 서비스를 결합하면 다양한 조건을 넣어 모니터링 할 수 있음  


## * AWS Lambda 이용 요금

Lambda 이용 요금은 EC2와 같이 인스턴스가 실행되는 시간에 대해 과금되는 것이 아니라 **요청 수** 와 **처리 시간**에 따라 청구됨  


> 참고 : 그림과 작동 원리로 쉽게 이해하는 AWS 구조와 서비스