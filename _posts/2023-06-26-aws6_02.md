---
layout: single
title:  "[CHAP6] 데이터베이스 서비스 - 2"
categories: AWS
---

# 02. AWS에서 관계형 데이터베이스 사용

## * 관계형 데이터베이스 서비스 RDS

**Amazon Relational Database Service(RDS)**는 **관계형 데이터베이스**를 제공하는 서비스  
OS나 **데이터베이스 엔진**의 관리는 AWS 측에서 수행하므로 이용자는 몇 분 만에 데이터베이스를 생성해 이용할 수 있음  
EC2와 마찬가지로 종량 과금제이므로 RDS 인스턴스가 기동되는 시간만큼의 요금이 발생  
데이터베이스 엔진은 데이터베이스에 대한 데이터 **등록, 갱신, 삭제 처리를 관리하는 소프트웨어**  

* RDS가 지원하는 데이터베이스 엔진 (2022.11 기준)
  - MySQL
  - SQL Server
  - MariaDB
  - PostgreSQL
  - Oracle
  - Amazon
  - Aurora

이 중 **Amazon Aurora**는 AWS가 클라우드용으로 구축한 데이터베이스, MySQL 또는 PostgreSQL과 거의 동일하게 사용할 수 있게 두 가지 데이터베이스에 대한 호환성을 제공  
EC2나 온프레미스로 데이터베이스를 구축하면 사용자가 OS 설정이나 데이터베이스 엔진을 설치하고 설정해야 하므로 어느 정도 시간이 걸림  
하지만 RDS를 사용하면 데이터베이스 엔진이 설정된 상태로 만들어지므로 데이터베이스를 즉시 사용할 수 있음  
RDS에서 데이터베이스를 생성하기 위해 AWS 관리 콘솔을 이용하거나 API를 이용  
관리 콘솔을 이용하면 같이 사용할 엔진과 인스턴스 크기 등을 선택해 쉽게 데이터베이스를 생성할 수 있음  

* 입력할 내용
  - 데이터베이스 엔진, 버전
  - DB 인스턴스 식별자(이름)
  - 마스터 사용자 이름, 암호(로그인에 사용)
  - DB 인스턴스 클래스(인스턴스 유형, 머신 성능)
  - 스토리지 유형 설정(용량 및 성능 결정)
  - 다중 AZ 배포
  - 네트워크 설정(배치할 Amazon VPC 등)

필요한 정보를 입력하고 생성하면 초기화 작업이 진행되고 수 분 내에 데이터베이스를 사용할 수 있게 됨  


## * 데이터베이스 성능을 결정하는 인스턴스와 스토리치 유형

RDS도 EC2와 마찬가지로 선택한 **인스턴스**에 다라 성능이 달라짐  

* RDS 인스턴스 유형  
인스턴스의 성능(CPU, 메모리)은 인스턴스 크기를 선택해 결정  
인스턴스 크기의 명명 규칙  
```
db.m6g.large
```
db : db는 고정  
m : 패밀리 (메모리가 우선인지 범용인지에 따라 지정하는 문자열)  
6 : 세대 (숫자가 클수록 새롭고 고성능)  
g : 추가 기능 (Gravition2(CPU이름)의 g와 같이 인스턴스가 실행될 서버의 특징을 기재, 문자가 없는 종류도 있음)  
large : 크기 (크기가 클수록 고성능, 크기가 클수록 요금도 비쌈)  

이름 앞에 'db'가 고정된 것을 제외하고는 EC2와 동일한 규칙, 종량제 요금이며 시간당 단가는 인스턴스 크기에 따라 다름, 고사양으로 갈수록 비싸짐  

* 스토리지 유형
EBS와 마찬가지로 RDS에서도 데이터 저장을 위한 스토리지 설정을 할 수 있음  
데이터베이스는 데이터를 저장하는 것이 주된 목적이기 때문에 스토리지 선정이 매우 중요  

데이터를 저장하는 스토리지 유형  

|볼륨 유형|개요|
|---|---|
|범용 SSD|고성능으로 용량에 따라 읽기/쓰기 성능 결정|
|프로비저닝 IOPS SSD|고성능이며 지정한 읽기/쓰기 성능 확보|
|마그네틱 HDD|저렴한 비용|


## * 가용성 향상을 위한 예비 복제본과 읽기 성능 향상을 위한 읽기 전용 복제본

RDS는 데이터를 처리하는 **프라이머리 인스턴스** 외에 **예비 복제본(Standby replica)**을 다중 AZ에 배포해 가용성을 높일 수 있음  
**고가용성**이란 시스템이 중단되지 않고 작동할 수 있는 능력으로, RDS에서는 이를 예비 복제본으로 구현, 이 구성을 **다중 AZ 배포**라고 함  
프라이머리 인스턴스나 AZ에 장애가 발생하면 예비 복제본으로 전환해 데이터베이스를 계속 이용할 수 있음, 이 전환을 **장애 조치(Fail Over)**라고 함  
응용 프로그램에서 RDS에 접속할 때는 **엔드포인트**라는 DNS 형식의 접속 정보를 사용  
프라이머리 인스턴스에 장애가 발생하면 이 엔드포인트의 목적지가 자동으로 예비 복제본으로 전환됨  
RDS에는 읽기 전용으로 사용할 수 있는 **읽기 전용 레플리카**라는 기능  
읽기 전용 레플리카는 프라이머리 인스턴스에서 복제된 인스턴스, 읽기 요청이 늘어나면 인스턴스의 수를 늘리는 스케일아웃 방식으로 성능을 향상할 수 있음  
읽기 전용 레플리카는 어디까지나 읽기 전용이기 때문에 쓰기 성능을 향상할 수 없음, 쓰기 성능은 인스턴스 크기를 변경하는 스케일업으로 성능을 향상해야 함  
가용성 향상이 목적인 예비 복제본은 일반적으로 처리는 수행하지 않는 인스턴스이므로 성능 향상에 도움이 되지 않음  


## * RDS 보안 설정과 백업

* RDS 접근 제어  
RDS는 EC2와 마찬가지로 VPC 내에 생성, RDS 인스턴스를 생성하기 위해서는 최소한 두개의 서브넷이 필요  
서브넷은 리전 내의 서로 다른 AZ를 지정해야 함, 데이터베이스 접근 제어는 EC2와 마찬가지로 보안 그룹과 네트워크 ACL에서 설정  
일반적으로 데이터베이스에 접속하는 것은 VPC 내에 구축한 응용 프로그램(EC2 등에서 가동)일 경우가 많기 때문에  
해당 응용 프로그램에서만 데이터베이스에 접속할 수 있게 보안 그룹이나 네트워크 ACL로 적절하게 설정해야 함  

* 데이터베이스 엔진 업데이트  
접근 제어와 함께 중요한 것 중 하나가 데이터베이스 엔진 '업데이트'  
데이터베이스 엔진이나 데이터베이스 엔진이 실행되는 OS에 취약점(보안 결함)이 발생할 수 있으므로 정기적으로 버전 '업그레이드'를 해야 함  
이러한 버전 업그레이드 AWS 측에서 실시하지만 '업데이트' 작업은 **유지 관리 기간**이라는 사용자가 설정한 시간대에 실시  
유지 보수 작업을 하면 RDS 인스턴스가 일시적으로 오프라인(사용 불가)이 되므로 데이터베이스 사용률이 높은 이용 시간을 피해 설정해야 함  
다중 AZ 배포를 사용하는 경우 예비 복제본 -> 프라이머리 인스턴스 순서로 유지 보수가 실행됨, 접속이 발생하지 않는 인스턴스에 대해 유지 보수 작업을 수행하므로 영향을 줄일 수 있음  
그러나 데이터베이스 엔진 업그레이드(새 버전으로 변경)는 프라이머리 인스턴스와 예비 복제본이 동시에 업그레이드됨  

* 데이터 백업
데이터 보호를 위해서는 데이터가 손상되거나 손실되는 경우 복구할 수 있어야 함, 소프트웨어나 AWS의 장애, 사용자의 오작동으로 인해 데이터가 손상될 수 있음  
이러한 사태에서 데이터를 복구할 수 있게 데이터의 **백업**을 수행함  
RDS는 **자동 백업 기능**이 있어 사용자가 지정한 일 수만큼의 **스냅숏**이 자동 유지됨  
보존일수는 0 ~ 35일 사이로 지정할 수 있으며 0은 자동 백업 기능을 비활성화 하는 값  
첫 번재 스냅숏은 전체 데이터를 백업하지만 두 번째 이후의 스냅숏은 차분(처음 백업으로부터 변경된)데이터만 백업함, 기본적인 개념은 EBS 스냅숏과 동일  
스냅숏 취득 처리는 사용자가 지정한 **백업 윈도우**의 시간대에 실행됨, 사용자가 원하는 시간에 수동 스냅숏을 취득할 수 있음  
스냅숏 파일은 S3 버킷에 저장되므로 파일의 내구성은 매우 높음, S3에 보존되지만 사용자에게는 S3 버킷의 파일로는 보이지 않음, 구조상 S3가 사용되고 있을 뿐  
스냅숏은 백업된 데이터양에 대해 요금이 발생함, 일반적으로 사용하는 RDS의 스토리지 요금에 비해 10분의 1 정도의 요금이 발생  
스냅숏은 새 RDS 인스턴스를 생성하는 방식으로 복원할 수 있으며, 기존 RDS 인스턴스에는 복원할 수 없음  
**특정 시점 복구(PITR, Point in Time Recovery)**라는 기능을 이용해 특정 시간(최소 5분 전, 보존 기간 내)을 지정하고 복원할 수도 있음  
이는 데이터를 백업으로 계속 보존하는 용도보다 특정 시간으로 되돌리는 용도로 사용됨, 스냅숏과 데이터베이스의 변경 로그를 조합해 이 기능을 구현함  


> 참고 : 그림과 작동 원리로 쉽게 이해하는 AWS 구조와 서비스