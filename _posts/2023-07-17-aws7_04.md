---
layout: single
title:  "[CHAP7] 보안 관련 서비스 - 4"
categories: AWS
---

# 04. 설정 내역 및 설정 내용을 자동으로 관리

## * 설정 이력을 저장하는 AWS Config

**AWS Config**는 EC2 인스턴스나 보안 그룹과 같은 AWS 자원에 대한 구성 정보와 변경 이력을 남기는 서비스  
관리 콘솔에서 AWS Config를 활성화하기만 하면 자동으로 AWS 자원의 구성 정보를 수집하고 이력을 관리할 수 있음, 기본적으로 7년 치의 정보를 저장  
CloudTrail은 계정의 활동 이력을 저장하지만 AWS Config는 **AWS 자원의 설정 내용 기반**으로 이력을 저장, 둘 다 중요한 이력 정보이므로 AWS 계정 생성 후 기본적으로 활성화 하는게 좋음  
이력 정보가 남아있으면 문제가 발생해도 이력을 확인해 대응할 수 있음  
특히 보안과 관련한 사고는 설정 변경으로 인해 발생하는 경우가 많아 보안 사고가 발생한 시점의 변경 이력을 확인하면 어떤 이유로 사고가 발생했는지도 특정할 수 있음  
**고급 쿼리** 라는 기능을 이용해 특정 자원 수를 확인할 수 있음  

```
SELECT configuration.instanceType, COUNT(*)
WHERE resourceType = 'AWS::EC2::Instance'
GROUP BY configuration.instanceType
```
=> 인스턴스 종류별 EC2의 수를 확인하는 쿼리  
AWS Config 요금은 하나의 설정 항목당 0.003USD로 저렴하지만 자원 수가 늘어나면 사용료도 증가하므로 주의  
특정 자원 유형을 지정해 이력 정보를 남기는 것도 가능하니 요금을 줄이고 싶다면 자원 유형을 지정해 필요한 자원에 대해서만 이력을 남기는 것도 좋은 방법임  


## * 설정을 확인하는 AWS Config 규칙

**AWS Config 규칙**을 이용하면 AWS의 각 설정이 규칙을 준수하는지 확인할 수 있음  
* AWS Config 규칙을 이용해 설정을 확인하는 예
1. EBS가 암호화되어 있는가
2. CloudTrail이 사용 설정되어 있는가
3. S3 버킷이 공개적으로 읽고 쓸 수 없는가
4. 보안 그룹에 SSH 포트(22번)가 공개적으로 게시되지 않았는가

S3 버킷과 관련된 규칙이라면 AWS Config 규칙 화면에 AWS 계정이 소유한 S3 버킷 목록이 표시되고 각 규칙을 준수하고 있는지 표시됨, 규칙을 준수하지 않는 리소스는 **미준수** 라고 표시  
AWS에서 제공하는 규칙을 AWS **관리형 규칙**이라고 함, 그리고 사용자가 자신만의 규칙을 만들 수도 있는데 이것을 **사용자 지정 규칙**이라고 함  
처음에는 간단하게 사용할 수 있는 관리형 규칙을 사용하다가 자신만의 규칙을 만들어 최적화하는 것이 좋음  
AWS Config 규칙에서 미준수 자원이 발견됐을 때 **Amazon EventBridge**, **Amazon SNS**같은 서비스를 결합해 사용자에게 메일로 알림을 발송할 수 있음  
미준수 리소스를 자동으로 수정하는 기능도 AWS Config 규칙에 존재, '자동 문제 해결' 기능을 사용해 새로운 규칙을 추가하거나  
기존 규칙을 선택해 문제 해결 작업을 선택하면 대부분의 경우 자동으로 문제가 해결됨  
이 기능을 이용해 공개 상태로 설정된 S3 버킷을 일괄적으로 비공개 상태로 변경하는 등 AWS 내의 자원을 더욱 안전하고 편리하게 이용할 수 있음  
자동 수정은 **AWS Systems Manager**라고 하는 서비스의 Automation 이라는 기능을 이용함  
AWS Config 규칙은 설정 이력을 저장하는 AWS Config와는 별도로 요금이 발생함, 설정한 규칙이 평가될 때마다 0.001USD가 청구됨  
불필요한 규칙 평가는 이용 요금 상승의 원인이 되므로 규칙 평가를 하기 전에는 반드시 필요한 규칙인지 확인해야 함  


> 참고 : 그림과 작동 원리로 쉽게 이해하는 AWS 구조와 서비스