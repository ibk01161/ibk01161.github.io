---
layout: single
title:  "[CHAP5] 네트워크 및 콘텐츠 전송 서비스 - 3"
categories: AWS
---

# 03. Amazon VPC의 주요 기능 사용법

## * 라우팅 정보를 설정해 인터넷과 통신

- 라우팅 테이블
**라우팅 테이블**은 네트워크의 경로 정보, 온프레미스 환경에서는 라우터와 같은 네트워크 기기에 라우팅 테이블을 설정하지만  
AWS는 VPC에 라우팅 테이블을 생성하고 각 서브넷에 사용할 라우팅 테이블을 지정함  
VPC를 통해 흐르는 패킷은 이 라우팅 테이블의 정보를 기반으로 경로(어디로 통신할지)를 결정함  
VPC를 만들 때 기본적으로 하나의 라우팅 테이블이 만들어짐, 기본 상태에서는 VPC 내 라우팅 정보만 있으므로 VPC 외부로는 통신할 수 없음  
외부와 통신하려는 경우에는 외부 라우팅 정보를 추가해야 함  
예를 들어 대상 0.0.0.0/0(모든 네트워크) 에 대해 인터넷 게이트웨이로 라우팅 테이블에 등록하면 인터넷 게이트웨이를 통해 인터넷과 통신할 수 있음  

- 인터넷 게이트웨이
**인터넷 게이트웨이**는 서브넷 안에 있는 EC2와 같은 자원이 인터넷과 통신할 수 있게 하기 위한 기능  
인터넷 게이트웨이를 생성하고 서브넷의 라우팅 테이블에 설정하면 인터넷과 VPC가 서로 통신할 수 있게 됨  
인터넷 게이트웨이로 가는 경로가 설정된 서브넷을 **퍼블릭 서브넷**, 반대로 인터넷 게이트웨이를 통해 인터넷과 통신할 수 없는 서브넷을 **프라이빗 서브넷** 이라고 함  
EC2의 경우 **퍼블릭IP**또는 **Elastic IP**를 부여해 인터넷과 EC2가 통신할 수 있음, 퍼블릭 IP와 Elastic IP는 모두 **EC2에 설정할 수 있는 퍼블릭 IP(글로벌IP) 주소**임  
퍼블릭 IP는 자동으로 부여되는 IP 주소로 재부팅할 때마다 변경됨, Elasstic IP는 정적 IP라고도 하며 영구적으로 사용할 수 있는 IP 주소  
방화벽 등에서 IP 주소를 고정해 통신을 허가해야 하는 경우 Elastic IP를 사용  
퍼블릭 IP는 무료로 사용할 수 있지만, Elastic IP는 사용하지 않을 때 약간의 요금이 부가됨, 가동 중인 EC2 등에서 사용하는 경우 무료  


## * NAT 게이트웨이

프라이빗 서브넷에 있는 EC2와 같은 자원은 일반적으로 인터넷과 통신할 수 없음, 하지만 인터넷에 있는 소프트웨어 패키지의 다운로드와 같이 VPC 내에서 인터넷과 통신해야 하는 경우가 있음  
이때 사용할 수 있는 것이 **NAT 게이트웨이**, 인터넷 게이트웨이와 달리 인터넷에서 VPC로 통신할 수 없는 단방향 통신이므로 AWS 외부와 더 안전하게 통신할 수 있음  
NAT은 **Netwowrk Address Translation**의 약자로 **프라이빗 IP 주소를 퍼블릭 IP 주소로 변환** 하는 것을 의미  
NAT 게이트웨이는 프라이빗 서브넷의 IP 주소를 NAT 게이트웨이의 퍼블릭 IP로 변환해 인터넷과 통신할 수 있게 해줌  
NAT 게이트웨이를 이용해 통신하기 위해 외부 통신을 수행하는 서브넷의 라우팅 테이블에 경로 정보 (라우팅 정보)를 등록해야 함  


## * VPC 접근 제어 및 통신 로그 확인

VPC에는 서브넷 단위로 접근 제어를 설정할 수 있는 **네트워크 접근 제어 목록(네트워크 ACL)**이라는 기능이 있음  
**보안 그룹**과 조합해 접근 제어 설정이 가능함  

* 네트워크 ACL과 보안 그룹 비교

||네트워크 ACL|보안 그룹|
|---|---|---|
|설정 단위|서브넷 단위로 설정|인스턴스(자원) 단위로 설정|
|허용/거부 설정|허용 및 거부 설정 가능|허용만 설정 가능|
|상태 저장 여부|상태 비저장, 단일 패킷만 확인하므로 정보 저장 X|상태 저장, 패킷과 관련된 세션까지 확인하므로 정보 저장|
|규칙 우선 순위|등록된 규칙의 번호순으로 트래픽 허용 및 거부|등록된 모든 규칙을 평가해 트래픽 허용|

기본 설정 상태에서 네트워크 ACL은 모든 통신을 허용  
서브넷 전체에서 네트워크 접근을 허용하거나 거부하려는 경우 보안 그룹에서 추가 설정을 해 더욱 안전한 네트워크를 구축할 수 있음  
네트워크 ACL이나 보안 그룹에서 허용되거나 거부된 통신 상황은 **VPC 흐름 로그**라고 하는 VPC 내의 IP트래픽 상황을 로그로 저장할 수 있는 기능을 사용해 확인 가능  
로그는 AWS 모니터링 서비스인 CloudWatch Logs 또는 S3에 저장 가능함  
EC2와 같은 VPC의 자원은 IP 주솸다 **네트워크 인터페이스 (ENI, Elastic Network Interface)** 를 가짐  
로그는 네트워크 인터페이스별로 출력되며 Elastic Load Balancing, RDS, Redshift와 같이 VPC에서 실행되는 모든 서비스 로그도 출력됨  
도착지/출발지의 IP 주소와 포트, 전송 허용/거부 등 정보가 포함됨  

> 참고 : 그림과 작동 원리로 쉽게 이해하는 AWS 구조와 서비스